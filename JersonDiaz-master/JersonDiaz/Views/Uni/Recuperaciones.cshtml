
@using JersonDiaz.Clases
@model RecuperacionesX

@{
    ViewBag.Title = "Recuperaciones";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<div class="row">
    <br />
    <div class="col-lg-10"><h3>Recuperaciones | <small>Abonos a Prestamo</small></h3></div>
    <div class="col-lg-2">Fecha del sistema: <label>@DateTime.Now.ToShortDateString()</label></div>
    <br />
    <div style="width:98%;margin-left:1%;">
        <div class="page-title">
            <ol class="breadcrumb">
                <li>
                    <i class="fa fa-home"></i>  @Html.ActionLink("ir a la ventana", "Login", "Uni")
                </li>
                <li class="active"> Inicio</li>
            </ol>
        </div>
    </div>
</div>

<div class="row">
    @using (Html.BeginForm("Recuperaciones", "Uni", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.ValidationSummary(true)

        <input name="__RequestVerificationToken" type="hidden" value="4Rbzdk24McGjSsKnnTgtCWXUXfpQt5oDCujWAamlTiL8QuME-11yjYey5yHSASu87n7H3bKBcFmGAMHap7MItZXAht_FIZt_W1eYgtb23QM1">
        <fieldset>



            <div class="col-lg-12">
                <div class="portlet portlet-green">
                    <div class="portlet-heading">
                        <div class="portlet-title">
                            <h4>Datos</h4>
                        </div>

                        <div class="clearfix"></div>
                    </div>

                    <div>
                        <div class="portlet-body">
                            <div class="form-horizontal">
                                <div class="form-row">

                                    <div class="col-lg-3">
                                        <label>IdPrestamo:</label>
                                        @Html.TextBoxFor(Model => Model.IdPrestamo, new { @class = "input form-control text-box single-line x-monto ", id = "IdPrestamo", @readonly = "readonly" })
                                    </div>

                                    <div class="col-lg-6 no-show-ele2">
                                        <label>Cliente:</label>
                                        <select name="IdCliente" id="IdCliente" onchange="Recarga()" class="form-control">
                                            <option value="0">[----------------------SELECCIONE----------------------]</option>
                                            @foreach (var xaeco in ViewBag.Cls)
                                            {
                                                if (xaeco.IdCliente.ToString() == ViewBag.checkCl.ToString())
                                                {
                                                    <option class="no-show-ele1" value="@xaeco.IdCliente" selected>@xaeco.Cliente</option>
                                                }
                                                else
                                                {
                                                    <option class="no-show-ele1" value="@xaeco.IdCliente">@xaeco.Cliente</option>
                                                }
                                            }
                                        </select>

                                    </div>

                                    <div class="col-lg-3 no-show-ele2">
                                        <label>№ Prestamo:</label>
                                        <select id="Prestamo" onchange="RecargaDatos()" class="form-control" asp-items="@(new SelectList(string.Empty, "Value", "Text"))"></select>

                                    </div>



                                    <div class="col-lg-12">
                                        <label>&nbsp;</label>
                                    </div>

                                    <div class="col-lg-3">
                                        <label>Capital:</label>
                                        @Html.TextBoxFor(Model => Model.Capital, new { @class = "input form-control text-box single-line x-monto ", id = "Capital", @readonly = "readonly" })
                                    </div>

                                    <div class="col-lg-3">
                                        <label>Interes:</label>
                                        @Html.TextBoxFor(m => m.Interes, new { @class = "input text-box form-control single-line x-monto", id = "Interes", @readonly = "readonly" })
                                    </div>



                                    <div class="col-lg-3">
                                        <label>Seguro:</label>
                                        @Html.TextBoxFor(m => m.Seguro, new { @class = "input text-box form-control single-line x-monto", id = "Seguro", @readonly = "readonly" })
                                    </div>


                                    <div class="col-lg-3">
                                        <label>Deslizamiento:</label>
                                        @Html.TextBoxFor(Model => Model.Deslizamiento, new { @class = "input form-control text-box single-line x-monto", name = "Deslizamiento", id = "Deslizamiento", @readonly = "readonly" })
                                    </div>

                                    <div class="col-lg-12">
                                        <label>&nbsp;</label>
                                    </div>

                                    <div class="col-lg-3">
                                        <label>Cuota-Total:</label>
                                        @Html.TextBoxFor(Model => Model.TotalCuota, new { @class = "input form-control text-box single-line x-monto", id = "TotalCuota", @readonly = "readonly" })
                                    </div>

                                    <div class="col-lg-3 no-show-ele2">
                                        <label>Fecha-Pago:</label>
                                        @Html.TextBoxFor(Model => Model.FechaPago, new { @class = "input form-control text-box single-line", id = "FechaPago", @readonly = "readonly" })
                                    </div>

                                    <div class="col-lg-3 no-show-ele2">
                                        <label>Monto a Pagar:</label>
                                        @Html.TextBoxFor(Model => Model.MontoPagado, new { @class = "input form-control text-box single-line x-monto", id = "MontoPagado", })
                                    </div>




                                    <div class="col-lg-12">
                                        <label>&nbsp;</label>
                                    </div>

                                    <div class="col-lg-5">
                                        <label>&nbsp;</label>
                                    </div>


                                    <div class="col-lg-4">
                                        <label>&nbsp;</label>
                                    </div>



                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-lg-12">
                <div class="form-horizontal">
                    <div class="form-group">
                        <div class="col-lg-5"></div>
                        <div class="col-lg-2 text-center">
                            @*@using (Html.BeginForm("grabar", "CE_producto", FormMethod.Post))
                                {*@

                            <button type="submit" name="Grabar" value="1" class="btn btn-success">Aplicar Abono</button>
                            @* <a class="btn btn-danger" href="@Url.Action("ListarClientes","Uni")">Cancelar</a>*@
                            @* }*@

                        </div>
                        <div class="col-lg-5"></div>
                    </div>
                </div>
            </div>
            <!-- Fin de la colugna de 12 espacios col-lg-12 (Boton Guardar) -->
        </fieldset>


    }
</div>
<div>
    @if (ViewBag.modal == "mostrar")
    {
        <div id="id01" class="w3-modal" style="display:block;">
            <div class="w3-modal-content" style="width:25%;">
                <header class="w3-container w3-teal">
                    <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-display-topright">&times;</span>
                    <h3>@ViewBag.ModalTitulo</h3>
                </header>
                <div class="w3-container">
                    <p>@ViewBag.ModalMsj</p>
                </div>
                <footer class="w3-container w3-teal">
                    <p>@ViewBag.ModalPie</p>
                </footer>
            </div>
        </div>
    }
</div>

@section Scripts{
    <script>
        function Recarga() {
            //var ClienteId = document.getElementById("IdCliente").value;
            //Utilizo un get donde recupero un JSON para cargar mi segundo combo
            $.getJSON("/Uni/PrestamosCliente", { ClienteId: $("#IdCliente").val() }, function (d) {
                var row = "";
                $("#Prestamo").empty();
                $.each(d, function (i, v) {
                    debugger
                    row += "<option value=" + v.value + ">" + v.text + "</option>";
                });
                $("#Prestamo").html(row);

                //limpio las cajas
                $("#Seguro").val(0);//clase donde pasamos el texto que recuperamos del post en el controlador
                $("#Capital").val(0);
                $("#Interes").val(0);
                $("#Deslizamiento").val(0);
                $("#TotalCuota").val(0);
                $("#FechaPago").val('');

            })
        }

        function RecargaDatos() {
            var IdPrestamos = document.getElementById("Prestamo").value;
            //Utilizo un get donde recupero un JSON para cargar mi segundo combo

            var xhr = $.ajax({
                //LA URL
                url: "/Uni/PrestamosClienteDeuda",
                type: "POST",
                data: {
                    "IdPrestamo": IdPrestamos
                }
            });
            //respuesta que viene del controlador
            xhr.done(function (data) {
                debugger
                $("#Seguro").val(new Intl.NumberFormat("en-US").format(data.seguro));//clase donde pasamos el texto que recuperamos del post en el controlador
                $("#Capital").val(new Intl.NumberFormat("en-US").format(data.capital));
                $("#Interes").val(new Intl.NumberFormat("en-US").format(data.interes));
                $("#Deslizamiento").val(new Intl.NumberFormat("en-US").format(data.deslizamiento));
                $("#TotalCuota").val(new Intl.NumberFormat("en-US").format(data.totalCuota));
                $("#IdPrestamo").val((data.idPrestamo));
                $("#FechaPago").val(data.fechaPago);
              
            });

            xhr.fail(function () { });

        }


    </script>
}